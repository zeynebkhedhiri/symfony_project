{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard{% endblock %}

{% block body %}
    <h1>Admin Dashboard</h1>

    <h2>Users</h2>
    <ul>
        {% for user in users %}
            <li>{{ user.nom }} {{ user.prenom }} - {{ user.email }}</li>
        {% endfor %}
    </ul>

    <h2>Events</h2>
    <ul>
        {% for event in events %}
            <li>{{ event.name }} - {{ event.date }}</li>
        {% endfor %}
    </ul>

    <h2>Reservations</h2>
    <ul>
        {% for reservation in reservations %}
            <li>{{ reservation.nombrePersonnes }} people for {{ reservation.event.name }} at {{ reservation.dateDebut|date('Y-m-d H:i') }}</li>
        {% endfor %}
    </ul>
    <script>
        const token = localStorage.getItem('auth_token');  // Retrieve the token

        if (token) {
            fetch('/admin/dashboard', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token  // Add the token in the Authorization header
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Unauthorized');
                    }
                    return response.json();
                })
                .then(data => {
                    // Handle the response data here
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        } else {
            console.log('No token found, redirecting to login.');
            window.location.href = '/login/index';  // Redirect to login if no token exists
        }
    </script>

{% endblock %}
